"""
InvenioILS settings for InvenioILS Demo Site project.

This file was automatically generated by 'invenio-cli init'.
"""

import os
from datetime import timedelta
from invenio_app.config import APP_DEFAULT_SECURE_HEADERS

def _(x):
    """Identity function used to trigger string extraction."""
    return x


def _parse_env_bool(var_name, default=None):
    if str(os.environ.get(var_name)).lower() == "true":
        return True
    elif str(os.environ.get(var_name)).lower() == "false":
        return False
    return default


CORS_SEND_WILDCARD = False
CORS_SUPPORTS_CREDENTIALS = True
DEBUG = True
###############################################################################
# I18N
###############################################################################
#: Default language
BABEL_DEFAULT_LANGUAGE = "en"
#: Default time zone
BABEL_DEFAULT_TIMEZONE = "Europe/Zurich"
#: Other supported languages (do not include the default language in list).
I18N_LANGUAGES = [
    # ('fr', _('French'))
]

# Invenio-Theme
# =============
# See https://invenio-theme.readthedocs.io/en/latest/configuration.html

# Site tracking code template for matomo analytics
# Enable the below on the dedicated environment
# THEME_TRACKINGCODE_TEMPLATE = "demo_invenioils/trackingcode-prod.html"

###############################################################################
# Database
###############################################################################
SQLALCHEMY_DATABASE_URI="postgresql+psycopg2://demo-invenioils:demo-invenioils@localhost/demo-invenioils"

###############################################################################
# Search
###############################################################################
ELASTICSEARCH_HOST = os.environ.get("ELASTICSEARCH_HOST", "localhost")
ELASTICSEARCH_PORT = int(os.environ.get("ELASTICSEARCH_PORT", "9200"))
ELASTICSEARCH_USER = os.environ.get("ELASTICSEARCH_USER")
ELASTICSEARCH_PASSWORD = os.environ.get("ELASTICSEARCH_PASSWORD")
ELASTICSEARCH_URL_PREFIX = os.environ.get("ELASTICSEARCH_URL_PREFIX", "")
ELASTICSEARCH_USE_SSL = _parse_env_bool("ELASTICSEARCH_USE_SSL")
ELASTICSEARCH_VERIFY_CERTS = _parse_env_bool("ELASTICSEARCH_VERIFY_CERTS")

es_host_params = {"host": ELASTICSEARCH_HOST, "port": ELASTICSEARCH_PORT}
if ELASTICSEARCH_USER and ELASTICSEARCH_PASSWORD:
    es_host_params["http_auth"] = (ELASTICSEARCH_USER, ELASTICSEARCH_PASSWORD)
if ELASTICSEARCH_URL_PREFIX:
    es_host_params["url_prefix"] = ELASTICSEARCH_URL_PREFIX
if ELASTICSEARCH_USE_SSL is not None:
    es_host_params["use_ssl"] = ELASTICSEARCH_USE_SSL
if ELASTICSEARCH_VERIFY_CERTS is not None:
    es_host_params["verify_certs"] = ELASTICSEARCH_VERIFY_CERTS

SEARCH_ELASTIC_HOSTS = [es_host_params]
"""Elasticsearch hosts configuration."""

###############################################################################
# Flask configuration
###############################################################################
#: Secret key - each installation (dev, production, ...) needs a separate key.
#: It should be changed before deploying.
SECRET_KEY = "CHANGE_ME"
APP_ALLOWED_HOSTS = ["127.0.0.1"]

# if you need to render the Debugtoolbar, add 'unsafe-inline':
#   "script-src": ["'self'", "'unsafe-inline'"],
#   "style-src": ["'self'", "'unsafe-inline'"],
APP_DEFAULT_SECURE_HEADERS["content_security_policy"] = {
    "default-src": ["'self'"],
    "script-src": ["'self'"],
    "object-src": ["'self'"],
    "img-src": ["'self'"],
    "style-src": ["'self'"],
    "font-src": [
        "'self'",
        "data:",
        "https://fonts.gstatic.com",
        "https://fonts.googleapis.com",
    ],
}

###############################################################################
# Flask-Security
###############################################################################
# Disable user registration
SECURITY_REGISTERABLE = False
SECURITY_RECOVERABLE = False
SECURITY_CONFIRMABLE = False
SECURITY_CHANGEABLE = False
PERMANENT_SESSION_LIFETIME = timedelta(1)

###############################################################################
# OAI-PMH
###############################################################################
OAISERVER_ID_PREFIX = "oai:demo-invenioils:"

###############################################################################
# MAILS
###############################################################################
SUPPORT_EMAIL = "support@my_mail.com"
#: Librarians email for internal system notifications.
ILS_MAIL_NOTIFY_MANAGEMENT_RECIPIENTS = ["librarians@my_mail.com"]
#: Disable email sending by default.
MAIL_SUPPRESS_SEND = True
#: Email address for email notification sender.
MAIL_NOTIFY_SENDER = "librarians@my_mail.com"
#: Email address used as sender of account registration emails.
SECURITY_EMAIL_SENDER = SUPPORT_EMAIL
#: Email subject for account registration emails.
SECURITY_EMAIL_SUBJECT_REGISTER = _("Welcome to the InvenioILS Demo Site")

###############################################################################
# MAILS templates
###############################################################################
ILS_NOTIFICATIONS_TEMPLATES_CIRCULATION = {
    "bulk_extend": "demo-invenioils_bulk_extend.html",
    "cancel": "demo-invenioils_cancel.html",
    "request": "demo-invenioils_request.html",
    "request_no_items": "demo-invenioils_request_no_items.html",
    "checkin": "demo-invenioils_checkin.html",
    "checkout": "demo-invenioils_checkout.html",
    "extend": "demo-invenioils_extend.html",
    "overdue_reminder": "demo-invenioils_overdue_reminder.html",
    "expiring_reminder": "demo-invenioils_will_expire_in_reminder.html",
}

ILS_NOTIFICATIONS_TEMPLATES_DOCUMENT_REQUEST = {
    "request_accepted": "demo-invenioils_document_request_accept.html",
    "request_declined_user_cancel":
        "demo-invenioils_document_request_decline_user_cancel.html",
    "request_declined_in_catalog":
        "demo-invenioils_document_request_decline_in_catalog.html",
    "request_declined_not_found": "demo-invenioils_document_request_decline_not_found.html",
    "request_declined_other": "demo-invenioils_document_request_decline_other.html",
}

ILS_ILL_NOTIFICATIONS_TEMPLATES = {
    "extension_accepted": "demo-invenioils_patron_loan_extension_accept.html",
    "extension_declined": "demo-invenioils_patron_loan_extension_decline.html",
    "extension_requested": "demo-invenioils_patron_loan_extension_request.html",
}

ILS_NOTIFICATIONS_TEMPLATES = {"footer": "demo-invenioils_footer.html"}

###############################################################################
# Data model extensions
###############################################################################
ILS_RECORDS_METADATA_EXTENSIONS = {}

###############################################################################
# Vocabularies
###############################################################################
#ILS_VOCABULARIES = []
